# 아이템46. 타입 선언과 관련된 세 가지 버전 이해하기

1. 의존성 관리는 매우 힘듦. 전이적 의존성이 호환되는지 고려해야 함. 타입스크립트는 의존성 관리를 오히려 더 복잡하게 만듦. 다음 세 가지 사항을 더 고려해야 함.
    - 라이브러리의 버전
    - 타입 선언(@types)의 버전
    - 타입스크립트의 버전
    ex) npm install react / npm install --save-dev @types/react

2. 실제 라이브러리와 타입 정보의 버전이 별도로 관리되는 방식의 문제점. react@16.8.6 과 @types/react@16.8.19 -> 메이저버전(16)과 마이너버전(8)은 일치하나, 패치버전(6 / 19)은 다름.
    - 라이브러리를 업데이트 했지만 실수로 타입 선언은 업데이트하지 않는 경우. 런타임 오류 발생 가능
    -> 타입 선언도 업데이트하여 라이브러리와 버전을 맞추는 것이 좋지만, 타입 선언의 버전이 준비가 안되었을 경우, 보강 기법을 활용하거나 새 함수와 메서드의 타입 정보를 프로젝트 자체에 추가 + 타입 선언의 업데이트를 직접 작성하고 공개하여 커뮤니티에 기여

    - 라이브러리보다 타입 선언의 버전이 최신인 경우.
    -> 라이브러리와 타입 선언의 버전이 맞도록 버전을 맞추는 것이 좋다.

    - 프로젝트에서 사용하는 타입스크립트 버전보다 라이브러리에서 필요로 하는 타입스크립트 버전이 최신인 경우. 로대시, 리액트, 람다 같은 유명 라이브러리의 경우, 타입 시스템이 개선되고 버전이 올라간다. @types 선언 자체에서 타입 오류 발생
    -> 프로젝트의 타입스크립트 버전을 올리거나, 라이브러리 타입 선언의 버전을 원래대로 내리거나, declare module 선언으로 라이브러리의 타입 정보를 없애 버리면 된다.
    ex) npm install --save-dev @types/lodash@ts3.1

    - @types 의존성이 중복될 수 있다. 전역 네임스페이스에 있는 타입 선언 모듈에서 오류 발생.
    -> 어디서 타입 선언 중복이 발생했는지 추적 후 서로 버전이 호환되도록 만들면 된다.
    ex) npm ls @types/...

3. 타입스크립트로 작성된 라이브러리들은 자체적으로 타입 선언을 포함(bundling)하게 된다. package.json의 "types"필드에서 .d.ts 파일을 가리키게 된다. 이렇게 타입 선언을 포함하는 경우, 버전 불일치 문제를 해결하기는 하지만 문제점 존재.
    - 번들된 타입 선언에 보강 기법으로 해결할 수 없는 오류가 있는 경우, 또는 공개 시점에는 잘 동작했지만 타입스크립트 버전이 올라가면서 오류가 발생하는 경우에 문제 발생. 번들된 타입에서는 @types의 버전 선택이 불가능.
    - 프로젝트 내의 타입 선언이 다른 라이브러리의 타입 선언에 의존한다면 문제 발생. 의존성이 devDependencies에 들어가지만, 프로젝트를 공개하여 다른 사용자가 설치 시, 의존성 설치가 안되어 타입 오류가 발생.
    - 프로젝트의 과거 버전에 있는 타입 선언에 문제가 있는 경우, 과거 버전으로 돌아가서 패치 업데이트를 해야 한다.
    - 타입 선언의 패치 업데이트를 자주 하기 어렵다는 문제가 있다. 라이브러리 자체보다 타입 선언에 대한 패치 업데이트가 세 배나 많았다.

4. 권장사항은 라이브러리가 타입스크립트로 작성된 경우만 타입 선언을 라이브러리에 포함시키는 것. 자바스크립트로 작성된 경우는 타입 선언을 DefinitelyTyped에 공개하여 커뮤니티에서 관리하고 유지보수하도록 맡기는 것이 좋다.

5. 타입 선언을 라이브러리에 포함하는 것과 DefinitelyTyped에 공개하는 것 사이의 장단점을 이해해야 한다. 타입스크립트로 작성된 라이브러리라면 타입 선언을 자체적으로 포함하고, 자바스크립트로 작성된 라이브러리라면 타입 선언을 DefinitelyTyped에 공개하는 것이 좋다.